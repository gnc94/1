# python3 -m pip config set global.break-system-packages true
# sudo apt install python3-pip
# pip3 install telepot

import time
import telepot
import RPi.GPIO as GPIO
from telepot.exception import TelegramError

GPIO.setmode(GPIO.BOARD)
GPIO.setup(11, GPIO.OUT)

def handle(msg):
    chat_id = msg['chat']['id']
    command = msg['text']

    print("Got command:", command)

    if command == 'on':
        bot.sendMessage(chat_id, "LED on")
        GPIO.output(11, GPIO.HIGH)

    elif command == 'off':
        bot.sendMessage(chat_id, "LED off")
        GPIO.output(11, GPIO.LOW)

    elif command == 'stop':
        bot.sendMessage(chat_id, "Bot stopped")
        GPIO.cleanup()
        exit()

try:
    bot = telepot.Bot("YOUR_BOT_TOKEN_HERE")
    bot.message_loop(handle)
    print("I am listening...")

    while True:
        time.sleep(10)

except TelegramError as e:
    print("Telegram error:", e)
